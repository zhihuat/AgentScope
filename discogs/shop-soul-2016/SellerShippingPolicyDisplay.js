webpackJsonp([68],[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}return o.done?void e(s):Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)})}return r("next")})}}var a=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=n(378),s=n(337),c=n(338);n(673);var u=ds.require("layout"),l=ds.require("reactDialogs"),p=l.makeReactDialog,d=ds.require("ready"),h={};h.sellerName=null,h.sellerId=null,h.itemId=null,h.buyer_shipping_country=c.buyer_shipping_country||c.countryName,h.config={method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:c.authorization}},h.init=function(){var e=this;document.querySelector("body").addEventListener("click",function(t){t.target.classList.contains("show-shipping-methods")&&(c&&c.loggedIn?e.displayShippingMethods(t):e.showLoginMessage())})},h.showLoginMessage=function(){var e="/login?return_to="+encodeURIComponent(window.location.pathname),t='<a href="'+e+'">',n="</a>",r=c.countryName;p({title:s.getText("Shipping")(),content:s.getText("Shipping rates are based on your browser's location in %(country)s. Please %(tagOpen)slogin%(tagClose)s for accurate shipping rates.")({country:r,tagOpen:t,tagClose:n}),height:"mobile"===u.mode()?400:600,width:"mobile"===u.mode()?"100%":800,close:function(){if("#terms"===window.location.hash)return o.historyPushUrl("#")}})},h.displayShippingMethods=function(){var e=i(regeneratorRuntime.mark(function e(t){var n,r,i,a,c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=t.target.closest(".shortcut_navigable"),r=void 0,r=n&&n.classList.contains("unavailable")?n.querySelector(".show-shipping-methods"):n&&n.querySelector(".item_add_to_cart a")?n.querySelector(".item_add_to_cart a").dataset.itemId:null,i=t.target.dataset.sellerId,h.sellerId=i,h.sellerName=t.target.dataset.sellerUsername,h.itemId=r,e.next=10,this.getShippingMethods(i);case 10:a=e.sent,this.getShippingMethods(i,h.buyer_shipping_country).then(function(e){p({title:s.getText("Shipping")(),content:c.handleShippingPolicyData(e,a),width:"mobile"===u.mode()?"100%":800,height:"mobile"===u.mode()?400:600,close:function(){if("#terms"===window.location.hash)return o.historyPushUrl("#")}}).then(function(){var e=document.querySelector(".shipping-country-select");e.value=h.buyer_shipping_country,e.addEventListener("change",function(e){h.getShippingMethods(i,e.target.value).then(function(e){document.querySelector(".methods").innerHTML=h.changeShippingCountry(e)}),setTimeout(function(){return h.addSellerTermsListener()},500)}),h.addSellerTermsListener()})}).catch(function(){p({title:s.getText("Shipping")(),content:'<div class="methods">'+h.defaultMessage()+"</div>",width:"mobile"===u.mode()?"100%":800,height:"mobile"===u.mode()?400:600,close:function(){if("#terms"===window.location.hash)return o.historyPushUrl("#")}}).then(function(){return setTimeout(function(){return h.addSellerTermsListener()},500)})});case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),h.addSellerTermsListener=function(){var e=[].concat(r(document.querySelectorAll(".show-seller-terms")));e.length&&e.forEach(function(e){e.addEventListener("click",function(){h.getSellerTerms().then(function(e){var t=document.querySelector(".methods"),n=s.getText("View Shipping Rates")();t.innerHTML='\n                        <button class="view-shipping-methods">\n                            '+n+"\n                        </button>\n                        <hr>\n                    ",t.innerHTML+=e,t.querySelector(".view-shipping-methods").addEventListener("click",function(){h.viewShippingMethods()})})})})},h.getShippingMethods=function(){var e=i(regeneratorRuntime.mark(function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n?"seller_id="+t+"&country="+n:"seller_id="+t,i=c.apiServer,a=i+"/v3/marketplace/shipping/policies?"+r,e.next=5,fetch(a,h.config);case 5:return o=e.sent,e.abrupt("return",o.json());case 7:case"end":return e.stop()}},e,void 0)}));return function(t,n){return e.apply(this,arguments)}}(),h.changeShippingCountry=function(e){var t=document.createElement("div"),n=s.getText("View Seller Terms")();return t.innerHTML+='<button class="show-seller-terms">'+n+"</button><hr>",e.policies.length?e.policies.forEach(function(n){n.methods.length?n.methods.forEach(function(n){t.innerHTML+=h.createShippingMethodMarkup(n,e.currency)}):t.innerHTML+=h.defaultMessage()}):t.innerHTML+=h.defaultMessage(),t.innerHTML},h.viewShippingMethods=function(){try{var e=document.querySelector(".shipping-country-select"),t=e.options[e.selectedIndex].value;h.getShippingMethods(h.sellerId,t).then(function(e){document.querySelector(".methods").innerHTML=h.changeShippingCountry(e),setTimeout(function(){return h.addSellerTermsListener()},500)})}catch(e){document.querySelector(".methods").innerHTML=h.defaultMessage(),setTimeout(function(){return h.addSellerTermsListener()},500)}},h.handleShippingPolicyData=function(e,t){if(e){var n=[];t.policies.forEach(function(e){e.countries.forEach(function(e){return n.push(e)})}),n.push(h.buyer_shipping_country);var i=[].concat(r(new Set(n)));i.sort();var a=document.createElement("select");a.className="shipping-country-select",a.id="shipping-country-select",i.forEach(function(e){var t=document.createElement("option");t.textContent=e,t.value=e,a.add(t)});var o=document.createElement("div"),c=s.getText("View Seller Terms")();o.innerHTML+='<button class="show-seller-terms">'+c+"</button><hr>",e.policies.length?e.policies.forEach(function(t){t.methods.length?t.methods.forEach(function(t){o.innerHTML+=h.createShippingMethodMarkup(t,e.currency)}):o.innerHTML+=h.defaultMessage()}):o.innerHTML+=h.defaultMessage();var u='\n            <div class="shipping-header">\n                <label for="shipping-country-select">\n                    <strong>'+s.getText("To: ")()+"</strong>\n                    "+a.outerHTML+'\n                </label>\n                <hr>\n            </div>\n            <div class="methods">\n                '+o.outerHTML+"\n            </div>\n        ";return u}return h.defaultMessage()},h.createShippingMethodMarkup=function(e,t){var n=Array.isArray(e.ranges[0])?"V1":"V2",r=e.delivery_min,i=e.delivery_max,o=s.getText("%(delivery_min)s - %(delivery_max)s Business Days")({delivery_min:r,delivery_max:i}),u=document.createElement("div");u.className="inset",("Free Shipping"===e.name||"Local Pickup"===e.name||0===r&&0===i)&&(o="");var l=new Intl.NumberFormat(c.locale.replace("_","-"),{style:"currency",currency:t});if("format"===e.range_type){var p=["",s.getText("Vinyl (Large)")(),s.getText("Vinyl (Small)")(),s.getText("CD")(),s.getText("Cassette")(),s.getText("DVD/Blu-ray")(),s.getText("Shellac")()],d=e.constraint_price,g=e.constraint_type;u.innerHTML+=h.subtotalMessage(d,g,l),e.ranges.forEach(function(e){var t=a(e,4),n=t[0],r=t[1],i=t[2],o=t[3],c=document.createElement("div");if(c.innerHTML+=p[n]+" <b>"+l.format(r)+"</b>",i){var d="<b>"+l.format(i)+"</b>";c.innerHTML+=s.getText(" - plus %(price)s each additional")({price:d})}if(o){var h="<b>"+o+"</b>";c.innerHTML+=s.getText(" - up to %(itemLimit)s items maximum")({itemLimit:h})}u.innerHTML+=c.outerHTML})}if("weight"===e.range_type){var m=e.constraint_price,f=e.constraint_type,v=1;u.innerHTML+=h.subtotalMessage(m,f,l),e.ranges.forEach(function(e){var t="V1"===n?e[0]:e.max,r="V1"===n?e[1]:e.price,i="V1"===n?null:e.overflow_units,a="<b>"+l.format(r)+"</b>",o=i>0?s.getText("per each additional %(overflow_units)s grams")({overflow_units:i}):"",c=s.getText("%(gmMin)s to %(gmMax)s grams: %(priceMarkup)s")({gmMin:v,gmMax:t,priceMarkup:a}),p=s.getText("%(gmMin)s grams and up: %(priceMarkup)s")({gmMin:v,priceMarkup:a}),d="V1"===n?p:p+" "+o,h=0===t?d:c;u.innerHTML+="<div>"+h+"</div>",v=t+1})}if("quantity"===e.range_type){var y=e.constraint_price,T=e.constraint_type,M=e.format_ids,b=["",s.getText("Large Vinyl")(),s.getText("Small Vinyl")(),s.getText("CDs")(),s.getText("Cassettes")(),s.getText("DVDs/Blu-rays")()],x=void 0;M.length?(x=[],M.forEach(function(e){x.push(b[e])}),x=x.join(" / ")):x=s.getText("items")();var S=1;u.innerHTML+=h.subtotalMessage(y,T,l),e.ranges.forEach(function(e){var t="V1"===n?e[0]:e.max,r="V1"===n?e[1]:e.price,i="V1"===n?null:e.overflow_units,a="<b>"+l.format(r)+"</b>",o=i>0?s.getText("per each additional %(overflow_units)s items")({overflow_units:i}):"",c=s.getText("%(qtyMin)s to %(qtyMax)s %(formatText)s: %(priceMarkup)s")({qtyMin:S,qtyMax:t,priceMarkup:a,formatText:x}),p=s.getText("%(qtyMin)s %(formatText)s and up: %(priceMarkup)s")({qtyMin:S,priceMarkup:a,formatText:x}),d="V1"===n?p:p+" "+o,h=0===t?d:c;u.innerHTML+="<div>"+h+"</div>",S=t+1})}if("n/a"===e.range_type||!e.range_type){var L=e.constraint_price,w=e.constraint_type;u.innerHTML+=h.subtotalMessage(L,w,l)}var _='\n        <div class="shipping-method">\n            <b>'+("Local Pickup"===e.name?e.name:e.name+":")+'</b>\n            <span class="delivery-time">'+o+"</span>\n            "+u.outerHTML+"\n        </div>\n    ";return _},h.subtotalMessage=function(e,t,n){var r="<div>",i="</div>",a="<b>"+n.format(e)+"</b>",o=s.getText("%(divOpen)sSubtotal must be at least %(price)s to apply.%(divClose)s")({divOpen:r,price:a,divClose:i}),c=s.getText("%(divOpen)sSubtotal must be less than %(price)s to apply.%(divClose)s")({divOpen:r,price:a,divClose:i}),u="gte"===t?o:c,l="";return e>0&&(l+=u),l},h.defaultMessage=function(){var e=document.createElement("div"),t=h.itemId?"&item_id="+h.itemId:"",n="<a href=/messages/compose?to="+h.sellerName+t+' class="message-seller rates-unavailable">',r="</a>";return e.className="methods",e.innerHTML=s.getText("This seller does not have shipping rates for your region and may not be able to ship to your address. %(messageOpener)sCheck with the seller%(messageCloser)s if they’re able to ship to your location, and request shipping rates to be set for your country.")({messageOpener:n,messageCloser:r}),e.outerHTML},h.getSellerTerms=i(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="/user/"+h.sellerName+"/settings/seller/terms",e.next=3,fetch(t,h.config);case 3:return n=e.sent,e.abrupt("return",n.text());case 5:case"end":return e.stop()}},e,void 0)})),d(function(){return h.init()}),e.exports=h}]);
//# sourceMappingURL=SellerShippingPolicyDisplay.js.map