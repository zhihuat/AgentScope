'use strict';(function(f){var n=window.AmazonUIPageJS||window.P,t=n._namespace||n.attributeErrors,e=t?t("UdmRefreshAssets",""):n;e.guardFatal?e.guardFatal(f)(e,window):e.execute(function(){f(e,window)})})(function(f,n,t){f.when("A","udm-refresh-manager","quantity-dropdown-constants","udm-metrics-publisher").execute("quantity-dropdown-udm-refresh",function(e,b,a,d){function c(){k(a.SELECTORS.DELIVERY_BLOCK_AJAX_PARAMS).toArray().map(function(a){return l(a)}).forEach(function(a){return b.registerFeature(q,
{successHandler:h,failureHandler:m},a)})}function l(h){return h?Number(h.getAttribute(a.HTML_ATTRIBUTES.AUI_PAGE_STATE).match(a.REGEX.DELIVERY_BLOCK_AJAX_PARAMS)[1]):NaN}var k=e.$,q={featureName:a.FEATURE_REGISTRATION.NAME,featureAttribution:a.FEATURE_REGISTRATION.CTI,mandatoryParams:{quantity:"1"}},h=function(){d.logMetric(a.METRICS.QTY_REFRESH_SUCCESS)},m=function(){d.logMetric(a.METRICS.QTY_REFRESH_FAILURE)};e.on(a.EVENTS.PAGE_UPDATE,function(){c()});c();k(a.SELECTORS.QUANTITY_DROPDOWN).live("change",
function(h){try{if(!h.updateUdmOnQuantityChange){h.updateUdmOnQuantityChange=1;var c=k(this).val(),e=k(this).closest(a.SELECTORS.ACCORDION_ROW),m=l(e.find(a.SELECTORS.DELIVERY_BLOCK_AJAX_PARAMS)[0]);isNaN(m)||b.refresh({featureName:a.FEATURE_REGISTRATION.NAME},{quantity:c},m)}}catch(r){f.log("Quantity Dropdown UDM Refresh Failed with ERROR: "+r,"ERROR","QuantityDropdown"),d.logMetric(a.METRICS.QTY_REFRESH_FAILURE)}})});"use strict";f.register("quantity-dropdown-constants",function(){return{FEATURE_REGISTRATION:{NAME:"QUANTITY",
CTI:"Website/DEX Evaluation/Alternative Offer Eligibility Message"},EVENTS:{PAGE_UPDATE:"a:pageUpdate"},SELECTORS:{DELIVERY_BLOCK_AJAX_PARAMS:"script[data-a-state*\x3d'delivery-block-ajax-params']",ACCORDION_ROW:'\'[id$\x3d"AccordionRow"], #buybox, [id^\x3d"newAccordionRow"]\'',QUANTITY_DROPDOWN:"#selectQuantity [name\x3d'quantity'], #mobileQuantityDropDown"},REGEX:{DELIVERY_BLOCK_AJAX_PARAMS:/delivery-block-ajax-params-(\d+)/},HTML_ATTRIBUTES:{AUI_PAGE_STATE:"data-a-state"},METRICS:{QTY_REFRESH_SUCCESS:"UDM-REFRESH-QUANTITY-SUCCESS",
QTY_REFRESH_FAILURE:"UDM-REFRESH-QUANTITY-FAILURE"}}});"use strict";f.when("A").register("udm-refresh-allowlisted-features",function(e){var b={QUANTITY:{mandatoryParams:["quantity"]},SERVICE_OPTIONS:{mandatoryParams:["vas"]}};return{get:function(){return Object.keys(b)},getMandatoryParamsForFeature:function(a){return b[a].mandatoryParams},getMandatoryParamsForAllFeatures:function(){var a=[];e.each(b,function(b){a=a.concat(b.mandatoryParams)});return a}}});"use strict";f.when("A","udm-refresh-allowlisted-features",
"udm-metrics-publisher").register("udm-refresh-feature-registration",function(e,b,a){function d(a){var h=!0;e.each(b.getMandatoryParamsForFeature(a.featureName),function(b){a.mandatoryParams.hasOwnProperty(b)||(f.log("FeatureData is missing the mandatoryParam "+b,"ERROR",c(a)),l("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),h=!1)});return h}function c(a){return a.featureName+" (C/T/I: "+a.featureAttribution+")"}function l(h,b){a.logMetric(h);a.logMetricWithSuffix(h,b)}var k={},q=["featureName",
"featureAttribution","mandatoryParams"];return{registerFeature:function(a,m,p){var g;a:{for(g=0;g<q.length;g++){var h=q[g];if(!a.hasOwnProperty(h)){f.log("UDM Refresh Manager: Feature Registration does not contain valid mandatory attribute: "+h,"ERROR",a);l("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName);g=!1;break a}}g=!0}if(!g)return!1;if(0>p)return f.log("UDM Refresh Manager: BuyingOptionIndex can not be less than 0","ERROR",c(a)),l("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),
!1;-1===b.get().indexOf(a.featureName)?(f.log("UDM Refresh Manager: Feature name is not allowlisted","ERROR",c(a)),l("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),g=!1):g=!0;if(!g||!d(a))return!1;g=k.hasOwnProperty(p)&&k[p].hasOwnProperty(a.featureName)?!0:!1;if(g)return!1;m.hasOwnProperty("successHandler")&&m.hasOwnProperty("failureHandler")?"function"!==typeof m.successHandler||"function"!==typeof m.failureHandler?(f.log("UDM Refresh Manager: Callbacks are not of type function","ERROR",
c(a)),l("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),g=!1):g=!0:(f.log("UDM Refresh Manager: Functions missing in callbacks passed","ERROR",c(a)),l("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),g=!1);if(!g)return!1;g={};h=a.featureName;m={featureName:a.featureName,featureAttribution:a.featureAttribution,callbacks:m,mandatoryParams:a.mandatoryParams};h in g?Object.defineProperty(g,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):g[h]=m;k.hasOwnProperty(p)||(k[p]={});
e.extend(k[p],g);l("UDM-FEATURE-REGISTRATION-REQUEST-SUCCESS",a.featureName);return!0},getDataForFeature:function(a,b){return k.hasOwnProperty(b)&&k[b].hasOwnProperty(a)?k[b][a]:null},getRegisteredFeatures:function(a){return Object.keys(k[a])}}});"use strict";f.when("A","udm-refresh-framework").register("udm-refresh-manager",function(e,b){return{refresh:function(a,d,c){return b.refresh(a,d,c)},registerFeature:function(a,d,c){return b.registerFeature(a,d,c)}}});"use strict";f.when("A","udm-refresh-feature-registration",
"udm-gxa-handler","udm-refresh-dom-accessor","udm-refresh-allowlisted-features","udm-metrics-publisher","udm-glow-cip-migration-weblab").register("udm-refresh-framework",function(e,b,a,d,c,l,k){function q(a,b,d){if(!a.hasOwnProperty("featureName"))return f.log("UDM Refresh Manager: Feature data passed to UDM refresh manager without featureName property","ERROR",d),l.logMetric("UDM-REFRESH-REQUEST-INVALID"),!1;if(0>d)return f.log("UDM Refresh Manager: buyingOptionIndex cannot be less than zero.","ERROR",
a.featureName),u("UDM-REFRESH-REQUEST-INVALID",a.featureName),!1;var v=!0;e.each(c.getMandatoryParamsForFeature(a.featureName),function(c){b.hasOwnProperty(c)||(f.log("UDM Refresh Manager: mandatory param: "+c+" is not present in request data.","ERROR",a.featureName),u("UDM-REFRESH-REQUEST-INVALID",a.featureName),v=!1)});return v}function h(a,b){return null==b||"undefined"===typeof b.asin?(f.log("UDM Refresh Manager: Refresh triggered for a buybox type which does not have the page state","ERROR",
a.featureName),u("UDM-REFRESH-REQUEST-INVALID",a.featureName),!1):!0}function m(a,b,c,d){b=n(a,b);a=p(a,c);c={asin:d.asin,merchantId:d.merchantId,exclusiveMerchantId:d.merchantId};k.isEnabled&&(c.deviceType=d.deviceType);null!=d.offerListingId&&(c.offerListingId=d.offerListingId);null!=d.locale&&(c.language=d.locale);return{gxaParams:e.extend({},t,c,a,b),featureStateToPersist:b}}function p(a,c){var d={},f=r[c];e.each(b.getRegisteredFeatures(c),function(b){b!==a&&e.extend(d,g(f,b,c))});return d}function g(a,
c,d){return a&&a.hasOwnProperty(c)?a[c]:b.getDataForFeature(c,d).mandatoryParams}function n(a,b){var d={};a=c.getMandatoryParamsForFeature(a);e.each(a,function(a){d[a]=b[a]});return d}function u(a,b){l.logMetric(a);l.logMetricWithSuffix(a,b)}var r={},t={clientId:"retailwebsite",deviceType:"web",showFeatures:"udmRefreshFeatures,deliveryBlock,priceBlockMs3Mir",ie:"UTF8",experienceId:"udmRefreshAjaxExperience"};return{registerFeature:function(a,c,d){return b.registerFeature(a,c,d)},refresh:function(c,
f,e){if(!q(c,f,e))return!1;var g=d.getDeliveryBlockPageState(e);if(!h(c,g))return!1;var k=m(c.featureName,f,e,g);a.fetchContentFromGxa(k.gxaParams).then(function(a){var f=k.featureStateToPersist;d.updatePage(e,a);r.hasOwnProperty(e)||(r[e]={});r[e][c.featureName]=f;u("UDM-REFRESH-REQUEST-SUCCESS",c.featureName);b.getDataForFeature(c.featureName,e).callbacks.successHandler()}).catch(function(a){u("UDM-REFRESH-REQUEST-FAILURE",c.featureName);b.getDataForFeature(c.featureName,e).callbacks.failureHandler()});
return!0}}});"use strict";f.when("A").register("udm-refresh-dom-accessor",function(e){var b=e.$;return{getDeliveryBlockPageState:function(a){a=b('script[data-a-state\x3d\'{"key":"delivery-block-ajax-params-'+a+"\"}']").text();return JSON.parse(a)},updatePage:function(a,d){var c=document.createElement("div");c.innerHTML=d;a=b('script[data-a-state\x3d\'{"key":"delivery-block-ajax-params-'+a+"\"}']").closest('[id$\x3d"AccordionRow"], #buybox, [id^\x3d"newAccordionRow"]');d=c.querySelector("#deliveryBlockSmallMessage");
b(a).find("#deliveryBlockSmallMessage").replaceWith(d);d=c.querySelector("#deliveryBlockMessage");b(a).find("#deliveryBlockMessage").replaceWith(d);c=c.querySelector("#primeBadge-ajax-feature");b(a).find("#priceBadging_feature_div").replaceWith(c);if(1===b("#buyBoxAccordion, #buybox").children().length||a.attr("id").match(/^newAccordionRow/))b("#price #priceblock_ourprice_row #ourprice_shippingmessage #priceBadging_feature_div").replaceWith(c),b("#newOfferShippingMessage_feature_div #ourPrice_availability #priceBadging_feature_div").replaceWith(c),
b("#price #priceblock_saleprice_row #saleprice_shippingmessage #priceBadging_feature_div").replaceWith(c),b("#price #priceblock_dealprice_row #dealprice_shippingmessage #priceBadging_feature_div").replaceWith(c)}}});"use strict";f.when("A").register("udm-metrics-publisher",function(e){function b(a,b){"undefined"!==typeof n.ue&&"undefined"!==typeof n.ue.count&&(null==b?n.ue.count(a,(ue.count(a)||0)+1):n.ue.count(a,b))}return{logMetric:b,logLatency:function(a,d,c){null==c&&(c=(new Date).getTime());
b(a,c-d)},logMetricWithSuffix:function(a,d){b(a+"-"+d)}}});"use strict";f.when("A","3p-promise","udm-refresh-gxa-flow-migration-weblab","udm-metrics-publisher").register("udm-gxa-handler",function(e,b,a,d){function c(b){return(a.isEnabled?"/gp/product/ajax/udmRefreshAjaxExperience":"/gp/product/ajax")+"?"+Object.keys(b).map(function(a){return a+"\x3d"+b[a]}).join("\x26")}return{fetchContentFromGxa:function(a){var f=c(a),l=(new Date).getTime();return new b(function(a,b){e.get(f,{timeout:"10000",contentType:"application/x-www-form-urlencoded;charset\x3dutf-8",
dataType:"html",success:function(c){null==c||0===c.trim().length?(d.logLatency("UDM-GXA-NULL-RESPONSE-LATENCY",l),b(Error("EMPTY_RESPONSE_ERROR_MESSAGE"))):(d.logLatency("UDM-GXA-CALL-SUCCESS-LATENCY",l),a(c.trim()))},error:function(a){d.logLatency("UDM-GXA-CALL-FAILURE-LATENCY",l);b(a)}})})}}});"use strict";f.register("udm-refresh-gxa-flow-migration-weblab",function(){return{isEnabled:!0}});"use strict";f.register("udm-glow-cip-migration-weblab",function(){return{isEnabled:!1}})});