(function(g){var e=window.AmazonUIPageJS||window.P,k=e._namespace||e.attributeErrors,l=k?k("IveAdaptiveVideosAsset",""):e;l.guardFatal?l.guardFatal(g)(l,window):l.execute(function(){g(l,window)})})(function(g,e,k){(function(){function l(b){e.URLSearchParams&&"1"===(new e.URLSearchParams(e.location.search)).get("iveDebug")&&(e.DistributionMetricsDebugInfo?e.DistributionMetricsDebugInfo.push(b):e.DistributionMetricsDebugInfo=[b])}function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(b){var a=16*Math.random()|0;return("x"==b?a:a&3|8).toString(16)})}e.vseFeatures=e.vseFeatures||{};var p=e.gatedP||{register:function(b,a,c,f,d){void 0===d&&(d=e.vseFeatures);g.now(b).execute(b+"-prereg",function(h){h||d[a]||(d[a]=!0,f.resolve(c(f)).then(function(){g.now(b).execute(b+"-reg",function(c){c||(g.log("Gated registration failed to register module!","ERROR",b),d[a]=!1)})}))})},declare:function(b,a,c,f){void 0===f&&(f=e.vseFeatures);g.now(b).execute(b+"-prereg",function(d){d||f[a]||
(f[a]=!0,g.declare(b,c))})}},n={count:function(b,a){var c=e.ue;c&&c.count("vse:csm:"+b,a)},emitNexusMetric:function(b,a,c,f){void 0===f&&(f=!1);e.ue&&e.ue.event&&b&&b.events&&b.events[0]&&b.events[0].data&&(e.ue.event(b.events[0].data,a,c),f&&l(b.events[0].data))},emitSushiMetric:function(b,a,c,f){var d=this;void 0===a&&(a=!1);c=c||"https://unagi-na.amazon.com/1/events/com.amazon.eel.vse.metricstest.nexus";f=f||0;if(!(3<=f)){var h=JSON.stringify(b).replace(/\\\\/g,""),m={params:h,paramsFormat:"json",
contentType:"application/json; charset\x3dutf-8",error:function(){d.emitSushiMetric(b,a,c,++f)}},y=navigator.userAgent.match(/iPhone/i),e=!1;g.now("mash").execute("vse-detect-mshop",function(){e=!0});var k=null!==y&&e;g.when("A").execute("Emit-VSE-Metrics",function(a){navigator&&navigator.sendBeacon&&!k?navigator.sendBeacon(c,h):a.post(c,m)});a&&l(b)}},logFatal:function(b,a,c){e.ueLogError&&e.ueLogError(c,{logLevel:"FATAL",attribution:b,message:a})},logError:function(b,a,c){e.ueLogError&&e.ueLogError(c,
{logLevel:"ERROR",attribution:b,message:a})}},q={makeApplicationSushiPayloadBuilder:function(b,a){return function(c){var f={eventSource:a.eventSource,requestId:a.requestId,sessionId:a.sessionId,placementContext:a.placementContext,creativeId:a.creativeId||"",marketplaceId:a.marketplaceId,weblabIds:a.weblabIds,clientId:a.clientId,isInternal:a.isInternal.toString(),isRobot:a.isRobot.toString(),pageAsin:a.pageAsin,customerId:a.customerId,sessionType:a.sessionType||1,refMarkers:a.refMarkers,eventId:w(),
timestamp:new Date,userAgentData:navigator.userAgent,titleSessionId:0,videoAsin:0,pageUrl:null!==e.location.href?e.location.href.substring(0,500):"",videoAsinList:a.videoAsinList||"",rankingStrategy:""};return{events:[{data:b.$.extend(f,c)}]}}},makeApplicationNexusPayloadBuilder:function(b,a){return function(c){var f={eventSource:a.eventSource,placementContext:a.placementContext,userAgentData:navigator.userAgent,videoAsin:a.videoAsin||"",pageAsin:a.pageAsin||"",videoAsinList:a.videoAsinList||"",titleSessionId:"0",
stringPayload:"",intPayload:1,rankingStrategy:"",creativeId:a.creativeId||"",clientId:a.clientId,pageUrl:null!==e.location.href?e.location.href.substring(0,500):"",customerId:a.customerId||""};return{events:[{data:b.$.extend(f,c)}]}}},makeClickstreamNexusPayloadBuilder:function(b,a){return function(c){return b.$.extend({timestamp:new Date,actionType:a.actionType,eventOwner:a.producerId,eventType:a.eventType,productId:a.productId},c)}},extendWithNewField:function(b,a,c){return b&&b.events&&b.events[0]&&
b.events[0].data?(b=b.events[0].data,b[a]=c,{events:[{data:b}]}):b}},r={fetchLatestPageState:function(b,a){b.state.replace(a,JSON.parse(b.$("script[type\x3d'a-state'][data-a-state*\x3d"+a+"]").html()));return b.state(a)},isDefined:function(b){return"undefined"!==typeof b&&null!==b}},z={sendRequest:function(b,a,c,f,d){b.ajax(a,{params:c,paramsFormat:"json",crossDomain:!0,method:"POST",withCredentials:!0,contentType:"application/json",success:f,error:d})}},t={getClosedCaptions:function(b,a){var c=[];
if(!b.objectIsEmpty(a))for(b=a.split(","),a=0;a<b.length;a+=2)b[a+1]!==k&&c.push({locale:b[a],url:b[a+1]});return c}},u=function(){return function(b){var a=this;this.A=b;this.buildTag=function(c){if(!c.href)return"";var b="tag\x3d"+c.vendorTrackingId,d=c.asin;a.A.objectIsEmpty(d)||(d="\x26creativeASIN\x3d"+d);var h="linkCode\x3d",h=a.A.objectIsEmpty(c.linkCode)?h+"vse":h+c.linkCode,m=c.aciContentId,e="";a.A.objectIsEmpty(c.aciContentId)||(e="\x26asc_contentid\x3d"+m);b=b+"\x26"+h+d+e;b=0>c.href.indexOf("?")?
"?"+b:"\x26"+b;return c.href+b}}}(),d=function(){function b(){}b.IVE_ADAPTIVE_METRICS_PREFIX="ive:aw";b.ATTRIBUTION_NAME="ive-adaptive-videos-asset";b.HAS_IVE_VIDEO="has-ive-video";b.HAS_WATCH_BUTTON="has-watch-button";b.DATA_ASIN_SELECTOR="[data-asin]";b.ADAPTIVE_VIDEO_ELEMENT_SELECTOR="[data-product-asin]";b.ASIN="asin";b.DATA_ASIN_ATTR="data-asin";b.ADAPTIVE_VIDEOS_UPDATE_ENDPOINT="/vap/ew/adaptiveVideos/update";b.CANNOT_FIND_CLICKED_VIDEO="cannotFindClickedVideo";b.CANNOT_FIND_LB="cannotFindLightbox";
b.CANNOT_FIND_PAGESTATE="cannotFindPageState";b.UPDATE_AJAX_FAILED="updateAjaxFailed";b.FALLBACK="fallback";b.WATCH_BUTTON_INGRESS_TYPE="watchButton";b.INLINE_WITH_WATCH_BUTTON_INGRESS_TYPE="inlineWithWatchButton";b.AW_WATCH_BUTTON_SELECTOR=".ive-aw-watch-button";b.AW_WATCH_BUTTON_LABEL_SELECTOR=".ive-aw-watch-button-label";b.ADDITIONAL_MAX_WIDTH_LABEL_SPACE=11;b.EMPTY_STRING="";b.METRIC_WIDGET_THUMBNAIL_RENDER="widget:thumbnail:render";b.METRIC_WIDGET_THUMBNAIL_CLICK="widget:thumbnail:click";b.METRIC_WIDGET_THUMBNAIL_IMPRESSION=
"widget:thumbnail:impression";b.PLAYER_WRAPPER_SELECTOR=".ive-video-player-wrapper";b.INLINE_PLAYER_INGRESS_SELECTOR=".ive-insitu-ingress-player-placeholder";b.VIDEO_PLAYING_CSS_CLASS="ive-video-playing";b.OSP_LINK_CSS_CLASS="ive-inline-player-osp-link";b.X_BUTTON_CSS_CLASS="ive-inline-player-close-button";b.AUDIO_TOGGLE_CSS_CLASS="ive-inline-player-audio-toggle";b.CLICK_ATTRIBUTION_INITIAL_DELAY_SEC=2;b.INLINE_PLAYBACK_START="inlinePlaybackStart";return b}(),A=function(){return function(b,a,c,f,
x){var e=this;this.addIntersectionObserverToNewPFO=function(a){-1===e.childElems.indexOf(a)&&(e.intersectionInViewObserver.observe(a),e.intersectionOutOfViewObserver.observe(a),e.childElems.push(a))};this.onIntersectionObserved=function(a){for(var c=0;c<a.length;c++){var b=a[c],f=e.childElems.indexOf(b.target);b.isIntersecting&&e.intersectingCallback(f)}};this.onIntersectionOutOfViewObserved=function(a){for(var c=0;c<a.length;c++){var b=a[c];!b.isIntersecting&&e.A.$(b.target).hasClass(d.VIDEO_PLAYING_CSS_CLASS)&&
e.videoIsOutOfViewCallback()}};b===k&&(b=null);this.intersectingCallback=c;this.videoIsOutOfViewCallback=f;this.A=x;this.parentEle=b;this.childElems=Array.prototype.slice.call(b.querySelectorAll(a)).filter(function(a){return a.classList.contains(d.HAS_IVE_VIDEO)});this.intersectionInViewObserver=new IntersectionObserver(this.onIntersectionObserved,{rootMargin:"0px",threshold:.85});this.intersectionOutOfViewObserver=new IntersectionObserver(this.onIntersectionOutOfViewObserved,{rootMargin:"0px",threshold:.05});
this.childElems.forEach(function(a){e.intersectionInViewObserver.observe(a);e.intersectionOutOfViewObserver.observe(a)})}}(),B=k&&k.__assign||Object.assign||function(b){for(var a,c=1,f=arguments.length;c<f;c++){a=arguments[c];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(b[d]=a[d])}return b},v=function(){return function(b){var a=this;this.A=b;this.addVideoIngressAndMetricsHandlerForEligiblePFO=function(){a.vars.$widgetSelector.find(d.DATA_ASIN_SELECTOR).each(function(){var c=a.vars.A.$(this),
b=a.vars.asinToVideoAssetSpec[c.attr(d.DATA_ASIN_ATTR)];b&&!c.hasClass(d.HAS_IVE_VIDEO)&&a.vars.videoIngressConfig.injectVideoIngress?(a.addVideoIngress(this),c.addClass(d.HAS_IVE_VIDEO),a.vars.thumbnailIntersectionObserver&&c[0]&&a.vars.thumbnailIntersectionObserver.addIntersectionObserverToNewPFO(c[0])):b&&c.hasClass(d.HAS_IVE_VIDEO)||(-1===a.vars.asinsWithoutVideo.indexOf(c.attr(d.DATA_ASIN_ATTR))&&a.vars.asinsWithoutVideo.push(c.attr(d.DATA_ASIN_ATTR)),a.removeVideoIngress(this),c.removeClass(d.HAS_IVE_VIDEO))})};
this.addVideoIngressClickHandler=function(){a.vars.$widgetSelector.undelegate(a.vars.videoIngressPlaceholder,"click touch");a.vars.$widgetSelector.delegate(a.vars.videoIngressPlaceholder,"click touch",function(c){try{if(!a.isInlineVideo()||!a.isPlayerOverlayElements(c.target)){a.vars.clickedVideo&&(a.vars.previouslyClickedVideo=a.vars.clickedVideo);var b=a.vars.A.$(this).closest(d.DATA_ASIN_SELECTOR).attr(d.DATA_ASIN_ATTR);a.vars.clickedVideo=a.vars.asinToVideoAssetSpec[b];if(a.vars.clickedVideo){var e=
a.getModalFactory();a.vars.lightboxPopover=e&&e.get(a.vars.A.$("#"+a.vars.popoverTriggerId));if(a.vars.lightboxPopover)c.preventDefault(),c.stopPropagation(),a.movePlayerToLightbox(),a.vars.lightboxPopover.show();else throw a.postCount(d.CANNOT_FIND_LB),Error("Cannot find Lightbox for asin: "+b);a.emitNexusMetricWithProductAsin(a.vars.clientPrefix+":"+d.METRIC_WIDGET_THUMBNAIL_CLICK,b)}else a.postCount(d.CANNOT_FIND_CLICKED_VIDEO),a.vars.A.$(this).closest(d.DATA_ASIN_SELECTOR).removeClass(d.HAS_IVE_VIDEO)}}catch(h){a.fallback(h)}})};
this.addLightboxAfterShowAndBeforeHideEvents=function(){a.vars.A.off("a:popover:afterShow:"+a.vars.popoverId);a.vars.A.on("a:popover:afterShow:"+a.vars.popoverId,function(c){try{var b=void 0;if(a.vars.lightboxOpenedFirstTime){var d=a.vars.A.$(c.popover.$popover).find("[data-css-class]");d.length&&a.vars.A.$(c.popover.$popover).addClass(d.attr("data-css-class"));a.vars.lightboxOpenedFirstTime=!1;b=a.vars.clickedVideo.productAsin}else b=a.vars.clickedVideo.contentId!==a.vars.previouslyClickedVideo.contentId?
a.vars.clickedVideo.productAsin:k;a.openLightbox(a.vars.clickedVideo,b)}catch(e){a.fallback(e)}});a.vars.A.off("a:popover:beforeHide:"+a.vars.popoverId);a.vars.A.on("a:popover:beforeHide:"+a.vars.popoverId,function(){a.closeLightbox()})};this.openLightbox=function(c,b){null!=a.vars.widgetMutationObserver&&a.vars.widgetMutationObserver.disconnect();a.vars.lightboxOpened=!0;a.vars.A.trigger("vse:"+a.vars.clientPrefix+":page:lightBoxOpened",{lightBoxId:a.vars.popoverId,lazyLoadProductAsin:b,assetSpec:c,
firstRelatedProductOverride:b})};this.closeLightbox=function(){a.vars.A.trigger("vse:"+a.vars.clientPrefix+":page:lightBoxClosed");a.movePlayerToIngress();a.vars.lightboxOpened=!1;null!=a.vars.widgetMutationObserver&&a.startObservingWidget()};this.addWidgetUpdateHandler=function(){a.vars.A.off("ive:"+a.vars.clientPrefix+":adaptiveWidget:update");a.vars.A.on("ive:"+a.vars.clientPrefix+":adaptiveWidget:update",function(){var c=[];a.vars.$widgetSelector.find(d.DATA_ASIN_SELECTOR).filter(function(){var b=
a.vars.A.$(this).attr(d.DATA_ASIN_ATTR);a.isNewlyAddedAsin(b)&&c.push(b)});0<c.length?z.sendRequest(a.vars.A,d.ADAPTIVE_VIDEOS_UPDATE_ENDPOINT,{asinList:c,contentStrategy:a.vars.contentStrategy,contentStrategyFilter:a.vars.contentStrategyFilter},function(c){c&&(c=a.convertToAdaptiveVideoAssetSpecList(c),a.addDataToAsinToVideoAssetSpec(c));a.addVideoIngressAndMetricsHandlerForEligiblePFO()},function(){a.postCount(d.UPDATE_AJAX_FAILED)}):a.addVideoIngressAndMetricsHandlerForEligiblePFO()});a.vars.A.off("ive:"+
a.vars.clientPrefix+":adaptiveWidget:updateWithData");a.vars.A.on("ive:"+a.vars.clientPrefix+":adaptiveWidget:updateWithData",function(){var c={};a.vars.$widgetSelector.find(d.ADAPTIVE_VIDEO_ELEMENT_SELECTOR).filter(function(){var b=a.vars.A.$(this).attr("data-product-asin");if(a.isNewlyAddedAsin(b)){var d={title:a.vars.A.$(this).attr("data-title"),vendorName:a.vars.A.$(this).attr("data-vendor-name"),contentId:a.vars.A.$(this).attr("data-content-id"),videoUrl:a.vars.A.$(this).attr("data-video-url"),
productAsin:b,groupType:a.vars.A.$(this).attr("data-group-type"),videoHeight:a.vars.A.$(this).attr("data-video-height"),videoWidth:a.vars.A.$(this).attr("data-video-width"),imageUrl:"",closedCaptions:t.getClosedCaptions(a.vars.A,a.vars.A.$(this).attr("data-closed-captions")),vendorTrackingId:a.vars.A.$(this).attr("data-vendor-tracking-id"),videoReferenceId:a.vars.A.$(this).attr("data-video-reference-id"),aciContentId:a.vars.A.$(this).attr("data-aci-content-id"),profileUrl:a.vars.A.$(this).attr("data-profile-url"),
profileAvatarUrl:a.vars.A.$(this).attr("data-profile-avatar-url")};c[b]=d}});a.addDataToAsinToVideoAssetSpec(c);a.addVideoIngressAndMetricsHandlerForEligiblePFO()})};this.fallback=function(c){a.vars.$widgetSelector&&a.vars.$widgetSelector.find(a.vars.videoIngressPlaceholder).hide();a.vars.lightboxOpened&&a.vars.lightboxPopover&&(a.vars.lightboxPopover.hide(),a.closeLightbox());a.postCount(d.FALLBACK);n.logError(d.ATTRIBUTION_NAME,"Fallback executed in IveAdaptiveVideosAsset for client "+a.vars.clientPrefix,
c)};this.addNexusMetricsConfigSetup=function(c){c.nexusMetricsConfig&&(a.vars.nexusMetricsConfig=c.nexusMetricsConfig,a.vars.buildNexusPayload=q.makeApplicationNexusPayloadBuilder(a.vars.A,a.vars.nexusMetricsConfig),a.vars.emitNexusMetric=!0)};this.addImpressionMetricIntersectionObserver=function(c){a.vars.thumbnailIntersectionObserver=new A(document.querySelector(""+c),""+d.DATA_ASIN_SELECTOR,a.thumbnailImpressionsTrackerForMultipleImpressions,a.videoIsOutOfView,a.vars.A)};this.thumbnailImpressionsTrackerForMultipleImpressions=
function(c){a.vars.A.delay(function(){var b=a.getAsinList();a.A.objectIsEmpty(b[c])||(b=b[c].attr(d.DATA_ASIN_ATTR),a.emitNexusMetricWithProductAsin(a.vars.clientPrefix+":"+d.METRIC_WIDGET_THUMBNAIL_IMPRESSION,b))},100)};this.isPlayerOverlayElements=function(c){return a.vars.A.$(c).hasClass(d.OSP_LINK_CSS_CLASS)||a.vars.A.$(c).hasClass(d.AUDIO_TOGGLE_CSS_CLASS)||a.vars.A.$(c).hasClass(d.X_BUTTON_CSS_CLASS)};this.videoIsOutOfView=function(){a.isInlineVideo()&&!a.vars.lightboxOpened&&a.stopVideoAndReturnToPFO()};
this.convertToAdaptiveVideoAssetSpecList=function(c){var b={};Object.keys(c).forEach(function(d,e){b[d]={title:c[d].title,vendorName:c[d].vendorName,contentId:c[d].asin,videoUrl:c[d].videoURL,productAsin:d,groupType:c[d].groupType,relatedProducts:d,closedCaptions:t.getClosedCaptions(a.vars.A,c[d].closedCaptions),vendorTrackingId:c[d].vendorTrackingId,videoReferenceId:c[d].referenceId,aciContentId:c[d].aciContentId,profileUrl:c[d].profileUrl,profileAvatarUrl:c[d].profileAvatarUrl,imageUrl:c[d].videoImage.url,
videoHeight:c[d].videoHeight,videoWidth:c[d].videoWidth}});return b};this.addVideoIngress=function(c){var b;a.vars.videoIngressConfig.type===d.WATCH_BUTTON_INGRESS_TYPE?b=a.vars.A.$(c).find(a.vars.videoIngressConfig.selector):a.vars.videoIngressConfig.type===d.INLINE_WITH_WATCH_BUTTON_INGRESS_TYPE&&(b=a.vars.A.$(c).find(a.vars.videoIngressConfig.watchButtonSelector),a.vars.initializeInlinePlayerCalled||(a.initializeInlinePlayer(),a.registerPageLevelOrchestrator(),a.vars.initializeInlinePlayerCalled=
!0));a.addWatchButton(b)};this.addWidgetMutationObserver=function(){a.vars.widgetMutationObserver=new MutationObserver(function(c){for(var b=0;b<c.length;b++){var d=c[b];if(d.addedNodes[0]instanceof HTMLElement&&(d.addedNodes[0].dataset.asin||d.addedNodes[0].querySelector("[data-asin]"))){a.vars.A.trigger("ive:"+a.vars.clientPrefix+":adaptiveWidget:update");break}}});a.startObservingWidget()};this.startObservingWidget=function(){a.vars.widgetMutationObserver.observe(document.getElementById(a.vars.$widgetSelector.attr("id")),
{childList:!0,subtree:!0})};this.addWatchButtonHoverHandler=function(c){var b=0;c=c&&""!==c.trim()?c:"."+d.HAS_IVE_VIDEO;a.vars.$widgetSelector.delegate(c,"mouseenter mouseleave",function(c){a.vars.A.$(this).toggleClass("ive-is-hovering","mouseenter"===c.type);var e=a.vars.A.$(this).find(d.AW_WATCH_BUTTON_SELECTOR),m=parseInt(e.css("max-width"),10);a.vars.watchButtonInitialMaxWidth||(a.vars.watchButtonInitialMaxWidth=m);0===b&&(b=a.vars.A.$(this).find(d.AW_WATCH_BUTTON_LABEL_SELECTOR).width());m=
"mouseenter"===c.type?m+(b+d.ADDITIONAL_MAX_WIDTH_LABEL_SPACE):a.vars.watchButtonInitialMaxWidth;e.css({"max-width":m+"px"})})};this.movePlayerToLightbox=function(){a.isInlineVideo()&&(a.vars.playerOptions.movePlayerToLightbox(a.vars.currentPFO.$videoContainer,a.vars.currentPFO.clickedAssetSpec),a.togglePFOVisibility(!0))};this.movePlayerToIngress=function(){a.isInlineVideo()&&(a.stopVideoAndReturnToPFO(),a.resetWatchButtonWidth(),a.vars.currentPFO.$parentContainer.removeClass("ive-is-hovering"),
setTimeout(function(){return a.vars.playerOptions.movePlayerToIngress(a.vars.currentPFO.$videoContainer)},50))};this.removeVideoIngress=function(c){a.vars.A.$(c).find(a.vars.videoIngressConfig.selector).find(d.AW_WATCH_BUTTON_SELECTOR).css("display","none")};this.addWatchButton=function(c){var b=a.vars.$widgetSelector.find(d.AW_WATCH_BUTTON_SELECTOR);b&&0<b.length&&c.removeClass("aok-hidden").html(b.clone().removeClass("aok-hidden")[0].outerHTML).find(d.AW_WATCH_BUTTON_SELECTOR).animate({opacity:1},
300).css({display:"flex"})};this.initializeInlinePlayer=function(){a.vars.A.on("vse:ns:inlinePlayer:"+a.vars.clientPrefix+":ready",function(c){a.vars.player=c.playerInstance;a.vars.playerOptions=c;a.addInlinePlaybackClickHandler();a.vars.player.on("playbackComplete",a.stopVideoAndReturnToPFO);a.vars.A.on("vse:ns:inlinePlayer:"+a.vars.clientPrefix+":closeButton:click",a.stopVideoAndReturnToPFO);a.vars.player.on("timeupdate",function(){var c=+a.vars.player.getCurrentTime().toFixed(0);0>a.vars.currentPFO.videoWatchTracker.timestamps.indexOf(c)&&
a.vars.currentPFO.videoWatchTracker.timestamps.push(c);a.vars.currentPFO.videoWatchTracker.totalWatchDuration=a.vars.currentPFO.videoWatchTracker.timestamps.length;a.isOspEnabledVideo(a.vars.currentPFO.clickedAssetSpec)&&!1===a.vars.currentPFO.videoWatchTracker.isOspParamsAdded&&a.vars.currentPFO.videoWatchTracker.totalWatchDuration===d.CLICK_ATTRIBUTION_INITIAL_DELAY_SEC&&(a.updatePFOUrlWithOspAttribution(),a.vars.currentPFO.videoWatchTracker.isOspParamsAdded=!0)})})};this.registerPageLevelOrchestrator=
function(){a.vars.A.on("ive:adaptiveWidget:videoStartPlaying",function(){0===a.vars.A.$(a.vars.widgetSelector+":hover").size()&&0===a.vars.A.$(a.vars.widgetSelector+":focus").size()&&null!==a.vars.currentPFO.$parentContainer&&(a.stopVideoAndReturnToPFO(),a.resetWatchButtonWidth())})};this.resetWatchButtonWidth=function(){a.vars.A.capabilities.mobile||a.vars.currentPFO.$parentContainer.find(d.AW_WATCH_BUTTON_SELECTOR).css({"max-width":a.vars.watchButtonInitialMaxWidth+"px"})};this.addInlinePlaybackClickHandler=
function(){var c=!0;a.vars.$widgetSelector.undelegate(a.vars.videoIngressConfig.watchButtonSelector,"click");a.vars.$widgetSelector.delegate(a.vars.videoIngressConfig.watchButtonSelector,"click",function(b){try{a.vars.currentPFO.$videoContainer&&a.vars.currentPFO.$imageContainer&&a.stopVideoAndReturnToPFO();a.vars.currentPFO={watchButtonHtml:this,$imageContainer:a.vars.A.$(b.target).closest("."+d.HAS_IVE_VIDEO).find(a.vars.videoIngressConfig.pfoImageElementSelector),$videoContainer:a.vars.$widgetSelector.find(d.INLINE_PLAYER_INGRESS_SELECTOR),
$parentContainer:a.vars.A.$(b.target).closest("."+d.HAS_IVE_VIDEO),videoWatchTracker:{totalWatchDuration:0,timestamps:[],isOspParamsAdded:!1}};c&&(a.vars.currentPlayerContainer=a.vars.currentPFO.$videoContainer.detach().removeClass("aok-hidden"),c=!1);a.vars.currentPFO.$videoContainer=a.vars.currentPlayerContainer;if(0<a.vars.currentPFO.$imageContainer.length&&0<a.vars.currentPFO.$videoContainer.length&&a.vars.player){a.togglePFOVisibility(!1);a.toggleWatchButtonVisibility(!0);a.toggleLinkOutline(a.vars.currentPFO.$imageContainer,
!0);a.vars.currentPFO.$parentContainer.addClass(d.VIDEO_PLAYING_CSS_CLASS);a.vars.currentPFO.$imageContainer.first().after(a.vars.currentPlayerContainer);var e=a.vars.A.$(this).closest(d.DATA_ASIN_SELECTOR).attr(d.DATA_ASIN_ATTR);a.vars.currentPFO.clickedAssetSpec=a.vars.asinToVideoAssetSpec[e];a.vars.playerOptions.startPlaying(a.vars.currentPFO.clickedAssetSpec,a.vars.currentPFO.$videoContainer);a.vars.A.trigger("ive:adaptiveWidget:videoStartPlaying")}a.postCount(d.INLINE_PLAYBACK_START)}catch(g){a.stopVideoAndReturnToPFO(),
a.postCount(d.FALLBACK)}})};this.stopVideoAndReturnToPFO=function(){a.vars.player.pause();a.togglePFOVisibility(!0);a.toggleWatchButtonVisibility(!1);a.toggleLinkOutline(a.vars.currentPFO.$imageContainer,!1);a.vars.currentPFO.$parentContainer.removeClass(d.VIDEO_PLAYING_CSS_CLASS)};this.toggleLinkOutline=function(a,b){a.closest("a").css({outline:b?"none":"unset"})};this.toggleWatchButtonVisibility=function(c){a.vars.A.$(a.vars.currentPFO.watchButtonHtml).toggleClass("aok-hidden",c)};this.togglePFOVisibility=
function(c){a.vars.currentPFO.$imageContainer.first().css({visibility:c?"visible":"hidden"});a.vars.currentPFO.$videoContainer.first().css({visibility:c?"hidden":"visible"})};this.isInlineVideo=function(){return a.vars.videoIngressConfig.type===d.INLINE_WITH_WATCH_BUTTON_INGRESS_TYPE};this.getModalFactory=function(){var c=null;a.vars.A.capabilities.mobile?g.now("a-secondary-view").execute("ive-aw-secondary-view-factory",function(a){c=a}):g.now("a-modal").execute("ive-aw-modal-factory",function(a){c=
a});return c};this.postCount=function(c){n.count(d.IVE_ADAPTIVE_METRICS_PREFIX+":"+a.vars.clientPrefix+":"+c,1)};this.emitNexusMetric=function(c){a.vars.emitNexusMetric&&(c=a.vars.buildNexusPayload({eventName:c,stringPayload:d.EMPTY_STRING,intPayload:1}),n.emitNexusMetric(c,a.vars.nexusMetricsConfig.producerId,a.vars.nexusMetricsConfig.widgetMetricsSchemaId,a.vars.nexusMetricsConfig.isInternal))};this.emitNexusMetricWithProductAsin=function(c,b){a.vars.emitNexusMetric&&(c=a.vars.buildNexusPayload({eventName:c,
stringPayload:d.EMPTY_STRING,intPayload:1,productAsin:b}),n.emitNexusMetric(c,a.vars.nexusMetricsConfig.producerId,a.vars.nexusMetricsConfig.widgetMetricsSchemaId,a.vars.nexusMetricsConfig.isInternal))};this.getAsinList=function(){var c=[];a.vars.$widgetSelector.find(d.DATA_ASIN_SELECTOR).each(function(){var b=a.vars.A.$(this);b.hasClass(d.HAS_IVE_VIDEO)&&c.push(b)});return c};this.isOspEnabledVideo=function(b){return!a.vars.A.objectIsEmpty(b.vendorTrackingId)&&""!==b.vendorTrackingId};this.updatePFOUrlWithOspAttribution=
function(){a.vars.currentPFO.$parentContainer.find('a[href*\x3d"/dp/"]').each(function(){if(0>a.vars.A.$(this).attr("href").indexOf("linkCode")){var b={href:a.vars.A.$(this).attr("href"),asin:a.vars.currentPFO.clickedAssetSpec.productAsin,linkCode:a.vars.ospLinkCode,aciContentId:a.vars.currentPFO.clickedAssetSpec.aciContentId,vendorTrackingId:a.vars.currentPFO.clickedAssetSpec.vendorTrackingId},b=(new u(a.vars.A)).buildTag(b);a.vars.A.$(this).attr("href",b)}})};this.isNewlyAddedAsin=function(b){return-1==
a.vars.asinsWithoutVideo.indexOf(b)&&!a.vars.asinToVideoAssetSpec[b]};this.addDataToAsinToVideoAssetSpec=function(b){0<Object.keys(a.vars.asinToVideoAssetSpec).length&&(a.vars.asinToVideoAssetSpec=B({},a.vars.asinToVideoAssetSpec,b))};this.vars={A:b,clientPrefix:"",$widgetSelector:null,emitNexusMetric:!1,buildNexusPayload:"",nexusMetricsConfig:"",thumbnailIntersectionObserver:null,widgetMutationObserver:null,asinToVideoAssetSpec:null,videoIngressConfig:null,player:null,currentPFO:{$imageContainer:null,
$videoContainer:null,$parentContainer:null,clickedAssetSpec:null,watchButtonHtml:null},initializeInlinePlayerCalled:!1,widgetSelector:null,lightboxPopover:null,contentStrategy:null,contentStrategyFilter:null,clickedVideo:null,previouslyClickedVideo:null,asinsWithoutVideo:[],videoIngressPlaceholder:null,popoverId:null,popoverTriggerId:null,lightboxOpened:!1,lightboxOpenedFirstTime:!0,watchButtonInitialMaxWidth:0,ospLinkCode:""}}}(),C={GatedP:p,PostMetric:n,AuiUtils:r,MetricUtils:q,DelphiAttribution:u};
try{var D=function(b){return new b(function(a,b){g.when("A","ready").register("IveAdaptiveVideosAsset",function(b,c){return{initialize:function(a){var c=new v(b);try{var e=r.fetchLatestPageState(b,a);if(!e)throw c.postCount(d.CANNOT_FIND_PAGESTATE),Error("Cannot find pagestate");c.vars.clientPrefix=e.clientPrefix;c.vars.ospLinkCode=e.ospLinkCode;c.vars.popoverId=e.lightboxPopoverConfig.popoverId;c.vars.popoverTriggerId=e.lightboxPopoverConfig.popoverTriggerId;c.vars.$widgetSelector=b.$(e.widgetSelector);
c.vars.contentStrategy=e.contentStrategy;c.vars.contentStrategyFilter=e.contentStrategyFilter;c.vars.videoIngressConfig=e.videoIngressConfig;c.vars.videoIngressPlaceholder=c.vars.videoIngressConfig.selector;c.vars.widgetSelector=e.widgetSelector;c.vars.asinToVideoAssetSpec=c.convertToAdaptiveVideoAssetSpecList(e.asinToVideoAssetSpec);c.addVideoIngressAndMetricsHandlerForEligiblePFO();c.addVideoIngressClickHandler();b.capabilities.mobile||c.addWatchButtonHoverHandler(e.widgetHoverSelector);c.addLightboxAfterShowAndBeforeHideEvents();
c.addWidgetUpdateHandler();c.addNexusMetricsConfigSetup(e);!0===e.addWidgetMutationObserver&&c.addWidgetMutationObserver();c.addImpressionMetricIntersectionObserver(e.widgetSelector);c.emitNexusMetric(c.vars.clientPrefix+":"+d.METRIC_WIDGET_THUMBNAIL_RENDER)}catch(g){c.fallback(g)}},Utils:v,TestModules:C,_noneFeature:a()}})})};g.when("A","3p-promise").execute("IVE-gatedP-register-IveAdaptiveVideosAsset-client",function(b,a){p.register("IveAdaptiveVideosAsset","IveAdaptiveVideosAsset-client-registered",
D,a)})}catch(b){n.logError(d.ATTRIBUTION_NAME,"Error during IveAdaptiveVideosAsset module registration",b),n.count(d.ATTRIBUTION_NAME+".moduleFatal",1)}})()});